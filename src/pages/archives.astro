---
import BaseLayout from "../layouts/BaseLayout.astro";
import Menu from "../components/Menu.astro";
import Sidebar from "../components/Sidebar.astro";
import { fetchAllPosts } from "../lib/wp";
const posts = await fetchAllPosts(50, 100);
const groups = posts.reduce((acc: Record<string, { y: number, m: number, arr: typeof posts }>, p) => {
  const d = new Date(p.date);
  const y = d.getFullYear();
  const m = d.getMonth() + 1;
  const key = `${y}-${m}`;
  acc[key] = acc[key] || { y, m, arr: [] };
  acc[key].arr.push(p);
  return acc;
}, {} as Record<string, { y: number, m: number, arr: typeof posts }>);
const sortedKeys = Object.keys(groups).sort((a,b) => a > b ? -1 : 1);
---
<BaseLayout title="ğŸ“ç»Ÿè®¡å½’æ¡£">
  <div class="main_screen">
    <Menu />
    <div class="main">
      <main class="main_body">
        <div class="cat_guidang">
          <div class="cat_block">
            {sortedKeys.map((key) => {
              const g = groups[key];
              return (
                <>
                  <h3 style="text-align: center;padding: 2rem;">ğŸ“ {g.y} å¹´</h3>
                  <ul>
                    <li>
                      <div style="padding-left: 4.2rem;">ğŸ“… {g.y} å¹´ {g.m} æœˆ</div>
                      <ul class="cat_block">
                        {g.arr.sort((a,b)=> new Date(a.date) > new Date(b.date) ? -1 : 1).map(p => (
                          <li class="item"><span>{new Date(p.date).getDate()}</span><a href={`/${p.slug}/` } set:html={p.title.rendered}></a></li>
                        ))}
                      </ul>
                    </li>
                  </ul>
                </>
              );
            })}
          </div>
        </div>
      </main>
      <aside class="main_sidebar">
        <Sidebar />
      </aside>
    </div>
  </div>
</BaseLayout>
